var testPubKey = '-----BEGIN PGP PUBLIC KEY BLOCK-----\nVersion: Keybase OpenPGP v2.0.51\nComment: https:\x2F\x2Fkeybase.io\x2Fjacobj\n\nxsFNBFbgsv8BEADASo94fgj3IIvavWy7mHBWtwX9MTbEqDbXBsg9xzrv04NnAf5F\n9QN1FexeOnJ\x2Fla6\x2FiMej3h6o\x2Fvx6MhlrqL25xkIeAHcyANvd8IhV1HJrK4nXNQ2r\nKhDm2XVCROCjfdANPpw+kcu+TF\x2FZCb03Mej4dKLRKU4LAmymf3c12Bn3SaNV1gv0\naANUjwBfMN9Zu\x2F988u4Hs\x2FHO8\x2FVmgCbbmtXSwOIAPNnUvLzbczIpCdOe8oWtYkOs\n2X7HWoxSS+LGAoeKKZNcwNokDK1yhKVupc3VcVJxKmMVsxbZxuGbC55wXrqkyY0k\nlYgqN9yyHYG5NW4mlL7x82ct0KQoyaB0JTDLkh\x2Fn3aWciw\x2Fin6ifiRMtK4UNBs6c\nM9FP8uRpzXIO5SCPDiTpdWoIgD2GBzcE4+bn0tY6em+FRiO9pr\x2FMMg4s3g6rZnML\nD9eBj+ERlmZPaFlWGgRlsy1SR0Soe06vOYnj5ALPwkSEf1epEWPZd1lK7nRZ1CTI\nFpi9pfdTBEOL3jTY7JK+QCnDX8DPe4GAck6odb16rFBFJe6BcpgVmo7s9gb0YRs1\nvmyLny66y6Kcc8SwpdzM9lhFnNgJA8G0QWLQQX0T\x2Fl1WbH\x2FBnbTf0\x2F9MHe+N1HRw\n77hLVX+Ok+caE4CFXts\x2FwChav67+Fqf9CGVSMdgBtD4YysIxgY6hELgXlQARAQAB\nzSRKYWNvYiBKZW5raW5zIDxtZUBqYWNvYmVqZW5raW5zLmNvbT7CwXQEEwEKAB4F\nAlbgsv8CGwMDCwkHAxUKCAIeAQIXgAMWAgECGQEACgkQs3t+v\x2F5V9fGmthAAstCu\nmA8iSVD3wALjaOa+NNZpSGP4gSxAXJHbJWXfu\x2FkFVJBn\x2F+aZhse0H2hj8PrbIiwD\ncFgQniiIAtV9WA8FCaOxrRucvtyMcMyMZy8CJRGMUFI2N037auaBoyoCHUqDK4ct\nHUwexyJrMsIiCO\x2F8ijZyH7\x2FJtWgGLLgsITQ753ImgAZXIPrVx+Fl4jgY6Xbh5LcT\nTfUcx\x2FlJ5odxMVzvFpbU4ufZn9r5Tx6cKwkwNVe9PnpDlBlaA+WvNfl9Ky5BGJ2R\nUmqk9QlVx0z1q1ysThhTRAopB+dCdt28IVcYFdKaMSUnF1FEjQPF8ABRtSiyEQIn\nuMweZsFy\x2FfWLBQ6GPLll2VucpKUaautNvmC84USPh\x2FA3LUaZaHQpyxvm2vCD5\x2Ffs\nXzSjH8aommqpVaNZfE47xpG28hBKXLIGdVDVepVOXMx2ApjIp2b6mmP1FFY4K451\n6o2+eyqKaz8H\x2FQntuRK7YPwUAemw5qG6Xo+vlV8IMuh\x2FTKmoYWkDOGe2S0v+KM2p\nPhkNP3zIeupkqO\x2FcW8AiOBQ8qz5TQ9wCWNN57KkwVdghrrYXvaazV+9usBw17m\x2FH\nYKaR1qndWgQsHAllR2OxQZ7A4ZdTSNuZIj\x2FLCDwVlPAox6\x2FuDwJfYaTV+AY5U9SM\n5gpORroI8Zdh84FuwerXcql9UV\x2FW0zrxt3IiX+DNJ0phY29iIEplbmtpbnMgPGph\nY29iQGphY29iZWplbmtpbnMuY29tPsLBcQQTAQoAGwUCVuCy\x2FwIbAwMLCQcDFQoI\nAh4BAheAAxYCAQAKCRCze36\x2F\x2FlX18VKfEACIuXdNpeGnF5P0yir1pJXVmZysQh49\nWSNGar7nVH3Nf81BrNmxNCJxXHRwyzKLd5vqvvKGHRLvgtPqlvCKrOTAolBPG6\x2Fx\nfhN0m5apFubqqjjoK7cZc8WHxOo4mVrZpMIg7h\x2FtDpImBtqtQkjtAoBLnjYZ5cEC\nnG\x2FlhyJQeh8lYHyp2xYfcwcZXbQ89KFPQMcVK9tWjbVzeKWxUhabGF8S96UbW0L3\nUh9\x2Fc\x2FzQXVld667qSi8weCqfa\x2FggBy0p7Zhcz6OspPIm2StLkX5WfAsYE59GfL16\nhcElUKLvaaL2TK2yh1NCm4cxAHmkeaYW3PAMCjbbysRz4Nd5cVg9N9LJ2DRE3S3\x2F\nXZ9cMfYGn5mxiP3e\x2Fhlhipv257gpOfnkbWQa0oiz8LSK1ggj\x2F2s7Nt4\x2F6wLqopmn\nSJ\x2F7gB9J2UhJ0SD\x2FDMGHqS1o+1fGZJP8E95MXf11E8ECZ3WVNR3nnE\x2FTsu1TW2N6\n76UY6JC+CktuU24kCt8eMTcUDJ1SAZzYb5+wXbOUsD98QmQ2O4zOL\x2FKoCQkSNQ4n\nb\x2F+6AU\x2FbbSkLqc3TKYtt2MNT5U\x2F2UjIhLZU7wiCftmncClQZlXibN8af7V\x2Fp7MWt\nXcA2T2PuLBTSanTkWhXslmTMBjrta+Dj4rMTaS0osEq2w\x2FImisKMNeUZSLRTrkzn\nAboG5xsMkCUfts7ATQRW4LL\x2FAQgA2+yvB35gHrr+RwYsKV9OkMtpn5KjAcF0HHlz\nhclNr\x2FVMaoNsulIri7NkFKOK0gsQiJ2ry4DiqQiHWDstLYVohWNJvQPku7dtj4yt\nCJINxHd+hR4dvuLAaf5sKAzDJr9NftBu4\x2FOCI7Q9P7m7HPuwhTAcc7RI7B7\x2F4r5X\nkjsMVXSMdZwEuaIjFZfwLdFJNf+Aqfsj4A3eezW\x2FfiAmOg5kXu3B0iYhz1OKC2vM\nv5PhUR+oEhWPYhAWOlTPfk6mlZyEXavReoX\x2FWO9lGv3YnMnw5Dpb3tl47vsk45TD\nTypIMGRf9FJkNJCbuOW9l0T3md7tIznWeTwUQYu\x2F9yPAz7Sm1QARAQABwsKEBBgB\nCgAPBQJW4LL\x2FBQkPCZwAAhsMASkJELN7fr\x2F+VfXxwF0gBBkBCgAGBQJW4LL\x2FAAoJ\nENZQptqEPxVtcEEH\x2F2Usc6B\x2Fbx4RziEBZ6OMzTrWdM2VMpkpBYytkdtTDlhQccE5\n8wwzxx\x2FNFY6aAwpOPRYAODzC\x2FioyTxKTTKFDoon2m6Ou2eKECISccVSqKtfS7iPc\nmhz6dp61XbLjl+tKl9UW4gUcyz9Zvtz0fvINpcHnM\x2Fh2sfIeofNcuT0tvHW4H\x2F1G\nIHGCKug\x2FquIY12Qi+KtVnJO3eZYZBkY70GDtf5fzjMNrbSLiGy7LDsCap0uy++\x2Fc\nlloZDx7mNwVumu7wq5EUll+IgwgFAxsph4QA0MyUpr0CmFv\x2F4QYRraZmBFUI38la\n0ZsZfG8h2c4w\x2FM7XC0w6vkMq87\x2FO2GpYC3s3UfjBAg\x2F5AS0c15d9h6E3XGhRMdCH\nL3B0tqgzq4q\x2FZ58BG4uGdhZtj094W6TbVF+IxBAZWZGWcadbGl2K1DW7NTUNvHyA\naF4l7k7+3YpokSJVjxqtDne4VI8918hbvTQxIVzz8iBtFTIpISQwHU+jzpwrXet4\nD4Gqb7aDO7NsuamHNzTK+Ba+GAvkbU6hoG4uMeyNhC8hZxsgRULDr+y0xpuEYJc6\nMtJOgDU7AjbSV23BnkgQdVdWpxmW2xjfsaS\x2FJEw\x2FowxelUQZKSnSdy8JRdbmVhyO\nKYDK75clohkZLW68zwX1N\x2FyjV7\x2FP\x2FOZ5rtvdGtdf9sXEEzxdUeHj\x2F\x2F9YLh0WfJy+\ngVxjq6uMfqvpir8jcuKXAv\x2Fkt32if998zlo0WbDsNxDp2JJFaRHBnkxeDIBOueCE\nnQvH1NkFfy\x2FBSc3yt7hf2nSr0h3AGH8lo68snzQz7jAEEn9tTv0A8BumomgzwtXv\n4KOFcBwI7O9R+Pw0xQ+i\x2FmOGXrUHigp1MxYL1uybj7aGPedm3Lw6z1jVC2s0fBDK\nmlw\x2F7XQVC8SigpaearxdyXIJtds1nSgcjPFITqcnvIH6vXmUroZBjbcBvgGDPwuA\n2qq7zo0y85NKW4\x2FLkiJgiJmi305AxNYP1yBhgCwufs0czSPxK4KrqZEBqx2zSA6i\nXeU4cy9wRwKFdwsZABf3PQ3OwE0EVuCy\x2FwEIAKGCc18u6znp19hhm3vGSXK\x2FIbfg\nLdQi684B9vHCBJnrOj+PWMKb7d6fz7BddTSHeYcXxIqx75r7NQuyMMN6HzE8JgVQ\nirniqUDK\x2FAPIhAh+b43ZMixkyYd0e9U+ly6Uw2UpaM\x2Fi6orlc7HsgPaTthhWT2\x2FP\nnd40z8I8d1PmXU\x2FTJYpUvlH\x2FmKAscyKx6M7utO10\x2F0e+Pcvq45GhtnVLL9bN+sTQ\n87nyXBaYbVXPvVTZRq76ktyrZIsXBN6SynKsE13O0j8Q95y\x2F70k10tgwDhCHHdFC\n39pXlk1JyJDC2fI4m0uf1y\x2FDfO41Bl2zIKpQDBvP+CmQf+1Y06+DS1QTeckAEQEA\nAcLChAQYAQoADwUCVuCy\x2FwUJDwmcAAIbIgEpCRCze36\x2F\x2FlX18cBdIAQZAQoABgUC\nVuCy\x2FwAKCRDu0NXs6VfL0ftHCACbLU6mc4XFrlBVGfa9KHFL6BQpuduUfnUxrKDG\nizMKtsZg05k7srR2AizleKUrfMDIpEIa90fB8rNoeQbQUDc2iDH9v7PF476Ql2K8\no2ExW4kcp9kGI4AI9XMmt8BCP5bvOON8VCHg2bPvUt6wUU\x2F3zNhcKx3x9XOw14Mf\nR6cEJwhJI9mf26996SNhvwKf3qqt8tB7bqQW\x2FiZH5g0HvsDLdWDNMVEtv4SIJNLu\nuFLwX3TF5rQgcMjTw\x2F1Uo3WgmqW8DaofGrbxFWHa0jcroe+g6YXx9XtyCIWrK9Ft\nitgBPDa90tWhU4tb+3c9UrgRSuDSPv3FE\x2FE4jvN0GBfExNJ2uXEP\x2FRGUGIJAqEgG\nSre0FAk1Go4fMCB1CrV\x2FntyYFHs27ea1oqqXrbv1qAVtlwGizvo2HX2IhOwNQ3Hj\nt\x2FJMhbrG0kSp899ZEnMXdNmsFmXqshmQ7kvQbEuWhxhPM6sNB0qXxXja40EeVPV\x2F\nsCz3zGJ72wEVLkO+HqA6\x2FDx41\x2FQA692RrDBh3iG7pP3meWDL2M0myf30Gz3iMT+I\nV2wW8MfVLeF6tI2jiCzp0L0Jutt1yJ1s+TLIY7hX+UVXj7ofR322IbakQqD3AywB\nr6NXDPzLbx45cS40f7rV7sEwLnBt+dSudK3rOXjiXoaiBEfhbREwgLHkxNhZnu1f\nDhzA3r7peX5y2hRXUhLEKhP\x2FxrXvSVKLJCW6n6LNXVfzidqmHUts4+ziKyZ9zFLQ\n7vNztGgvjcj8L0t121YKGNMYbRuIairFeWllovLCR\x2Fv1bTOIYUMWx\x2F3qVCE7rHeK\nnm48zT2dkP0FBl8PVZpU\x2FptEQywSpPmUBFlbCeZKlXH4sSgLx4Ero\x2FGJCBTK64QU\n4Yw4rkmlT4s5c5QxCFlOkHDiL+AYIyj0VWx1ntfuADILaRp1dZn2QPW8eCipMnmj\n6IdMvZZ+HZQCH9ta5yBC6Z+Mu93vjnjwdVR0uQR5vnofCGvIKuI9pAqLbbBqzwtc\nnuF96f5IN221bz7mMX9X0dWGC5Ikbxc5\n=0c0H\n-----END PGP PUBLIC KEY BLOCK-----';

var publicKeys = {};
var privateKeyEnc;
var privateKey;

function addPublicKey(userId, publicKey) {
    // Get usable public key
    publicKey = openpgp.key.readArmored(publicKey).keys;

    if (publicKeys[userId]) {
        if (publicKeys[userId] != publicKey) {
            // Alert the user.
        }
    } else {
        publicKeys[userId] = publicKey;
    }
}

addPublicKey('test', testPubKey);

function addPrivateKey(privateKey, password) {
    // Get usable private key
    privateKeyEnc = openpgp.key.readArmored(privateKey).keys;

    if (password) {
        unlockPrivateKey(password);
    }
}

function unlockPrivateKey(password) {
    privateKey = privateKeyEnc[0].decrypt(password);
    console.log('Priv', privateKey);
    // Possibly set up a timeout to delete this after a period of time.
}

function decrypt(userId, message) {
    var publicKey = publicKeys[userId];

    if (publicKey) {
        try {
            message = openpgp.message.readArmored(message);
        } catch(err) {
            // Something is wrong with the message, alert the user.
            console.log(err);
        }

        return openpgp.decryptAndVerifyMessagde(privateKey, publicKey, message);
    } else {
        // No public key, alert the user.
    }
}

function encryptAndSign(userId, message) {
    var publicKey = publicKeys[userId];

    if (publicKey) {
        console.log(privateKey);
        console.log(privateKeyEnc);

        var options = {
            data: message,
            publicKeys: publicKey,
            privateKeys: privateKey[0],
            armor: true
        };

        return openpgp.encrypt(options);
    } else {
        // No public key, alert the user.
    }
}
